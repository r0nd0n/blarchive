var channelCountsRefreshed=false;function channelResetRefresh(){channelCountsRefreshed=false;}
function channelRefreshCounts(id,name){if(window.location.pathname.indexOf(id)!==-1||window.location.pathname.toLowerCase().indexOf(name.toLowerCase())!==-1){if(!channelCountsRefreshed||document.visibilityState=='visible'){$.post({url:'/channel/'+id+'/counts/',data:{'csrfmiddlewaretoken':Cookies.get('csrftoken')},success:function(result){if(result.success){$('#subscriber_count').html(result.subscriber_count);$('#about-subscriber-count').html(result.about_subscriber_count);$('#about-view-count').html(result.about_view_count);channelCountsRefreshed=true;}},complete:function(){setTimeout(channelRefreshCounts,60000,id,name);}});}else{setTimeout(channelRefreshCounts,60000,id,name);}}}
function channelSaveSettings(channel){$.post('/channel/'+channel+'/save/',$('#save-settings').serialize(),function(result){$('#save-settings [id^="settings_error"]').addClass('hidden').text('');if(result.success){toastr.success('Your changes have been saved');$('#channel-title').text(result.display_name);$('#id_url_slug').val(result.url_slug);$('#channel-description').html(result.description);}else{toastr.error('Please resolve errors then resubmit');for(i=0;i<result.errors.length;i++){if(result.errors[i][0]=='__all__'){$('#settings_error').removeClass('hidden').text(result.errors[i][1]);}else{$('#settings_error_'+result.errors[i][0]).removeClass('hidden').text(result.errors[i][1]);}}
$('.nav-tabs a[href="#channel-settings"]').tab('show');}});}
function channelExtend(extend){var more=$('#channel-tabs .active .show-more');if(!more.hasClass('hidden')){more.addClass('hidden');var count=$('.channel-videos-list').children('.channel-videos-container').length;var url=window.location.href;url=(url.indexOf('?')>=0?url.split('?')[0]+'extend/?'+url.split('?')[1]:url+'extend/');$.post(url,{'csrfmiddlewaretoken':Cookies.get('csrftoken'),'name':name,'offset':count},function(result){if(result.success){$('.channel-videos-list').append(result.html);spaAttachEvents();playlistAttachEvents();$('[data-toggle="tooltip"]').tooltip({container:'body',trigger:'hover'});if($('.channel-videos-list').children('.channel-videos-container').length==count+extend)more.removeClass('hidden');}});}}
function setChannelState(channel,action){$.post('/channel/'+channel+'/state/',{'action':action,'csrfmiddlewaretoken':Cookies.get('csrftoken')},function(result){if(result.success){$('#channel-state-change-action').attr('href',result.target);if(useSPA)$('#channel-state-change-action').click();else window.location.href=$('#channel-state-change-action').attr('href');}else{$('#error_modal').modal('show');}});}