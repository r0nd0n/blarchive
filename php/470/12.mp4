let dataHeaderBtn=$("div[data-header-btn]"),dataHeaderNav=$("div[data-header-nav]"),socialNav=$("#modal-social"),app=$("#app"),headerBox=$("#header"),mainBox=$("#main"),euCookie="scx_euconsent",dataHeaderTop=$("[data-header-top]"),dataMenuShow=$("[data-menu-fixed]"),dataMenuNews=$("[data-menu-news]");var toggleMenu=function(){dataMenuNews.toggleClass("show")};let xDown=null,yDown=null;const API="https://sciencex.com/api/apps/web/physorg/",LST="pushNotify",VAPID="BOybuSIA7mfxsvZaBPCz4ZekXRVxHpk1Bt5KqGA1GGb5GNyAywD-ye1wFbPJm8KMnlLGuiBZHO4T0r87SdYnWA0";var Navigation=function(){this.target="[data-role=page]",this.pageBtn=$("a[data-page]").attr("disabled","disabled"),this.page=this.pageBtn.data("page"),$(this.target).data("page",this.page),this.filter=$("#sw-filter"),this.isLoading=0,this.didScroll=!1,this.cache="",this.page>1&&this.load(-1),this.preload();var t=this;$(window).on("scroll",function(){t.scroll()}),this.observer=setInterval(function(){t.didScroll&&(t.iniPagination(),t.didScroll=!1)},250),this.historyAPI=window.history&&window.history.replaceState,this.filter.on("change",function(){$(".list-heading").html(t.filter.is(":checked")?"Spotlight news":"All news"),t.reload()})};function webPush(t){"serviceWorker"in navigator&&"PushManager"in window?(this.cookieName="scx_push",this.cookie=$.fn.cookie(this.cookieName),null===this.cookie&&$.fn.cookie(this.cookieName,0,{path:"/",expires:1}),this.registerServiceWorker(t)):$("#webpush").on("click",function(){alert("Push messaging is not supported")})}function Tabs(t){var e=this;this.tabs=$(t).find(".nav-link"),this.tabs.click(function(){var t=$(this).attr("href");if("#"==t.charAt(0))return e.show(t),!1});var a=window.location.hash;a&&this.show(a)}function Comments(){if(this.api="/ajax/comments/",this.cm=$("#comments"),0==this.cm.length)return!1;this.id=this.cm.data("id");var t=this;this.cm.on("click","a[data-act=edit]",function(){var e=$(this).closest(".comment-row").data("cid");return t.get(e),!1}),this.cm.on("click","a[data-block]",function(){var e=$(this).closest(".comment-row").data("cid"),a=$(this).data("block")?0:1;return $.ajax({url:t.api+e+"/",type:"post",data:{state:a}}).done(function(){t.load(1),message("User "+(a?"added to":"removed from")+" your ignore list")}),!1}),this.cm.on("change","input[data-follow]",function(){return $.ajax({url:t.api,type:"post",data:{follow:1,newsid:t.id}}),!1}),this.cm.on("click","a[data-act=flag]",function(){if(confirm("Report this comment as spam, offensive or inappropriate?")){var e=$(this).addClass("fade").closest(".comment-row").data("cid");$.ajax({url:t.api+e+"/",type:"post",data:{flag:"1"}})}return!1}),this.cm.on("click","a[data-act=vote]",function(){var e=$(this),a=e.closest(".comment-row").data("cid"),i="down"==e.data("vote")?-1:1,o=e.parent().find("span[data-sum]");return e.addClass("voted").parent().addClass("disabled"),o.addClass("fade"),$.ajax({url:t.api+a+"/",type:"post",data:{vote:i}}).done(function(t){if(t.error)message(t.error);else{var e=parseInt(o.html());o.html(e+i)}o.removeClass("fade")}),!1}),this.cm.on("submit","form[name=comment]",function(){var e=$(this),a=e.serialize(),i=e.attr("action");return!e.data("ajaxExec")&&(e.data("ajaxExec",!0),$.ajax({url:i,type:"post",data:a,success:function(e){e.error&&message(e.error),e.success&&t.load(1)},complete:function(){e.data("ajaxExec",!1)}}),!1)})}function Sticky(){this.header=$("#header"),this.app=$("#app"),this.offset=this.header.height(),this.lastScrollTop=0,this.delta=5,this.app.css({"padding-top":this.offset}),this.header.css({position:"fixed",top:0}),this.visible=!0,this.ini()}function message(t){var e=$("template#alert").html();$("body").append(e),$("#modal-alert").find("p").html(t),setTimeout(function(){$("#modal-alert").addClass("active")},100)}function switchToFull(){return $.fn.cookie("scx_mobile",1,{path:"/",domain:window.location.hostname.match(/(\.[a-z0-9-]*?\.[a-z]{2,})$/)[1]})}function setConsentCookie(){return $.fn.cookie(euCookie,1,{path:"/",domain:window.location.hostname.match(/(\.[a-z0-9-]*?\.[a-z]{2,})$/)[1],expires:365})}function lazyLoad(){$("img[data-url]");$("img[data-url]").each(function(){var t=$(this),e=t.data("url"),a=$(new Image);a.one("load",function(){t.attr("src",e),t.removeAttr("data-url")}),a.attr("src",e)})}function lightbox(){var t=function(t){t.removeClass("active"),setTimeout(function(){t.remove()},300)};$("[data-lightbox]").each(function(){var e=$(this),a=e.find("a"),i=e.find("figcaption").html();a.on("click",function(){if(0==$(this).parents(".pgwSlider").length||0!=$(this).parents(".active").length){var e=window.location;window.location.hash="lightbox",setTimeout(function(){window.onhashchange=function(){t(o),window.onhashchange=$.noop}},0);var o=$("<div/>").addClass("modal right").appendTo("body"),n=$("<div/>").addClass("text-right col-12"),s=$("<div/>").addClass("lightbox").appendTo(o);$("<header/>").addClass("news-header").append(n).appendTo(o),$("<a/>").attr("href","#").html('<span class="icon">&times; close</span>').appendTo(n).on("click",function(){return t(o),history.replaceState({},"",e.pathname+e.search),!1}),s.append('<div class="preload"><span class="icon icon-spin1 animate-spin"></span></div>'),o.addClass("active");var r=new Image;return r.src=a.attr("href"),r.onload=function(){var t=$(r);if(s.html(t),i){var e=$('<div class="lightbox-caption">'+i+"</div>");s.append(e);var a=o.height()<t.height()+e.height()?0:e.height();t.css("margin-top","-"+a+"px")}},!1}})})}function handleTouchMove(t){if(!xDown||!yDown)return;let e=t.touches[0].clientX,a=t.touches[0].clientY,i=xDown-e,o=yDown-a;Math.abs(i)>Math.abs(o)&&(i>0?headerBox.data("menu-left")&&dataMenuShow.toggleClass("show"):headerBox.data("menu-right")&&dataMenuShow.toggleClass("show")),xDown=null,yDown=null}function resizeHeader(){if(dataHeaderBtn){let t=app.width()-dataHeaderBtn.width();dataHeaderNav.width(t)}}Navigation.prototype={scroll:function(){this.didScroll=!0},mostlyVisible:function(t){var e=$(window).scrollTop(),a=$(t).offset().top,i=$(t).height(),o=$(window).height();return a+i>e+.25*i&&a<e+.5*o},iniPagination:function(){var t=$(window).scrollTop();t>=.9*($(document).height()-$(window).height())&&0==this.isLoading&&this.load(1),t<=.9*$("#header").height()&&0==this.isLoading&&this.load(-1);var e=this;$(this.target).each(function(t){if(e.mostlyVisible(this)){var a=$(this).data("page");if(a!=e.page){e.page=a;var i=e.buildUrl(1==a?"./":"./page"+a+".html");e.historyAPI&&history.replaceState(null,null,i)}return!1}})},load:function(t){var e=this,a=t>0?$(this.target).last().data("page")+t:$("div[data-role=page]").first().data("page")+t;if(0!=a){var i=this.buildUrl(1==a?"./":"./page"+a+".html");t>0&&this.cache.length>0&&this.cache.data("page")==a?e.render(this.cache,t):(this.isLoading=1,$.get(i).done(function(i){var o=$(i).find(e.target);o.length>0?(o.data("page",a),e.render(o,t)):(e.pageBtn.addClass("invisible"),clearInterval(e.observer))}).always(function(){e.isLoading=0}))}},render:function(t,e){e>0?($(this.target).last().after(t),this.preload()):($(this.target).first().before(t),window.scrollTo(0,$(window).scrollTop()+$(this.target).first().height()),this.didScroll=!1),lazyLoad()},preload:function(){if(this.cache="",!this.isLoading){var t=this,e=$(this.target).last().data("page")+1,a=this.buildUrl("./page"+e+".html");$.get(a).done(function(a){var i=$(a).find(t.target);i.data("page",e),t.cache=i})}},reload:function(){var t=$(this.target);this.cache="",this.page=1;var e=this.buildUrl("./");this.isLoading=1;var a=this;$.get(e).done(function(i){a.historyAPI&&history.replaceState(null,null,e);var o=$(i).find(a.target);o.length>0&&(o.data("page",a.page),window.scrollTo(0,0),a.didScroll=0,t.first().before(o),t.remove(),lazyLoad())}).always(function(){a.isLoading=0})},buildUrl:function(t){var e=this.filter.is(":checked"),a=window.location.search.substring(1);if(a.length>0){for(var i,o=a.split("&"),n=o.length;n--;)if("spotlight"==(i=o[n].split("="))[0]){i[1]=e,o[n]=i.join("=");break}return n<0&&(o[o.length]=["spotlight",e].join("=")),t+"?"+o.join("&")}return t+"?spotlight="+e}},webPush.prototype={registerServiceWorker:function(t){var e=this;navigator.serviceWorker.register(t),navigator.serviceWorker.ready.then(function(t){"denied"===Notification.permission?($("#webpush").on("click",function(){alert("Notifications are blocked until this permission is manually changed in the browser")}),localStorage&&(localSub=localStorage.getItem(LST))&&e.deleteSubscription(JSON.parse(localSub))):($("#webpush").click(function(){e.changeState(t)}),t.pushManager.getSubscription().then(function(a){a?e.saveSubscription(a):e.createUI(t)}).catch(function(t){console.log("Error during getSubscription()",t)}))}).catch(function(t){console.error("Service Worker error",t)})},saveSubscription:function(t){var e;localStorage&&(e=JSON.parse(localStorage.getItem(LST)))&&t.endpoint==e.endpoint?$("#webpush").prop("checked","checked"):$.ajax({url:API+"subscribe/",type:"post",mode:"cors",data:{subscription:t.toJSON(),vapid:VAPID,utc_offset:(new Date).getTimezoneOffset()/-60},success:function(e){e&&0===e.failed&&localStorage&&(localStorage.setItem(LST,JSON.stringify({subscription:!0,endpoint:t.endpoint,vapid:VAPID,date:new Date})),$("#webpush").prop("checked","checked"))}})},deleteSubscription:function(t){$.ajax({url:API+"unsubscribe/",type:"post",mode:"cors",data:{subscription:t},success:function(){localStorage&&localStorage.getItem(LST)&&localStorage.removeItem(LST)}})},subscribe:function(t){var e=this;t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e.convertVapidKey(VAPID)}).then(function(a){t.showNotification("Awesome!",{body:"We will send you alerts for notable news stories. Please note that this subscription is browser specific, so if you want to receive notifications on another device, you will need to use it to re-subscribe.",icon:"https://sciencex.com/gfx/shared/phys_icon_192.png",tag:"scxNotify"}),e.saveSubscription(a)}).catch(function(t){console.log("Error during subscribe()",t)})},changeState:function(t){var e=this;return t.pushManager.getSubscription().then(function(a){a?a.unsubscribe().then(function(){e.deleteSubscription(a.toJSON())}):e.subscribe(t)}),!1},createUI:function(t){if("0"==this.cookie){var e=$("template#webpush").html();$("body").append(e),setTimeout(function(){$("#modal-push").addClass("active")},100);var a=this;$("#webpush-subsc").click(function(){return a.subscribe(t),!1}),$("#webpush-cancel").click(function(){$.fn.cookie("scx_push",1,{path:"/",expires:28})})}},convertVapidKey:function(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),a=window.atob(e),i=new Uint8Array(a.length),o=0;o<a.length;++o)i[o]=a.charCodeAt(o);return i}},Tabs.prototype={show:function(t){var e=this.tabs.filter('a[href="'+t+'"]');if(e.length>0){this.tabs.removeClass("active"),e.addClass("active"),$(t).show().addClass("active").siblings().hide().removeClass("active");var a=e.closest(".nav-item"),i=e.closest(".menu-tab-box");i.width()<a.position().left+a.width()&&i.scrollLeft(Math.round(a.position().left+a.width()-i.width()+15)),a.position().left<0&&i.scrollLeft(0)}}},Comments.prototype={load:function(t){var e=$("#comment-list");e.addClass("fade"),this.cm.load("/comments/"+this.id+"/"+(1==t?"?s="+Math.random():"")+" #comment-list",function(){e.removeClass("fade")})},get:function(t){var e=this;$.get(this.api+t+"/").done(function(a){if(a.success){var i=e.cm.find("form[name=comment]");i.find("textarea[name=comment]").val(a.comment),i.attr("action",e.api+t+"/"),$(window).animateScroll(i.position().top,200)}else message(a.errores)})}},Sticky.prototype={ini:function(){var t=this,e=!1;$(window).scroll(function(t){e=!0}),setInterval(function(){e&&(t.hasScrolled(),e=!1)},250)},hasScrolled:function(){var t=$(window).scrollTop();Math.abs(this.lastScrollTop-t)<=this.delta||(t>this.lastScrollTop&&t>this.offset?this.visible&&(this.header.css({transform:"translate3d(0, -"+this.offset+"px, 0)","-webkit-transform":"translate3d(0, -"+this.offset+"px, 0)"}),this.visible=!1):t+$(window).height()<$(document).height()&&(this.visible||(this.visible=!0,this.header.css({transform:"none","-webkit-transform":"none"}))),this.lastScrollTop=t)}},$(document).on("click","[data-toggle=modal]",function(){var t=$(this).data("target");if("#"==t.charAt(0))return $(".modal.active").each(function(){$(this).attr("id")!=t&&$(this).removeClass("active")}),$(t).toggleClass("active"),!1}),$(document).on("click","[data-dismiss=modal]",function(){return $(".modal.active").removeClass("active"),!1}),$(document).ready(function(){if(resizeHeader(),lazyLoad(),new Sticky,$(".pgwCarousel").length>0)$(".pgwCarousel").pgwSlider({displayControls:!0});lightbox(),$("[data-menu-toggle]").on("click",function(){return dataMenuShow.toggleClass("show"),!1}),$("[data-news-back]").on("click",function(){return-1!==document.referrer.indexOf("phys.org/")?history.back():window.location.href="https://m.phys.org/",!1}),$("#main").on("touchstart click",function(){$(".show").removeClass("show")}),$("a[data-page]").length>0&&new Navigation,$("[data-menu-fixed]").click(function(){dataMenuShow.removeClass("show")}),$("a[data-act=share]").click(function(){if(void 0===navigator.share)socialNav.toggleClass("active");else{var t=document.querySelector("link[rel=canonical]"),e=null!==t?t.href:document.location.href;navigator.share({url:e})}});var t=new Tabs(".nav-tabs");$("a[data-act=comments]").click(function(){t.show("#comments")}),$("form[name=feedback]").on("submit",function(){var t=$(this),e=t.serialize(),a=t.attr("action");return e+="&xRequest=true",$.ajax({url:a,type:"post",data:e}).done(function(){$(".modal.active").removeClass("active"),message("Thank you for taking your time to send in your valued opinion to Science X editors. You can be assured our editors closely monitor every feedback sent and will take appropriate actions. Your opinions are important to us.")}),!1}),$("a[data-act=save]").click(function(){var t=$(this).data("url");$.ajax({url:t,type:"get",xhrFields:{withCredentials:!0}}).done(function(){message("Saved to your Scince&nbsp;X account")}).fail(function(){message("Please sign in to Science X account")})}),$("a[data-act=settings]").click(function(){$("#modal-settings").find(".modal-content").load("/settings/ .settings",function(){dragula({isContainer:function(t){return t.classList.contains("dragula-container")},moves:function(t,e,a,i){return a.hasAttribute("data-active-toggle")&&(a.addEventListener("touchend",function(t){t.preventDefault()}),t.classList.toggle("active")),!!a.hasAttribute("data-active-move")}})})});var e=$(".menu-tab-box"),a=e.find(".active").parent();e.width()<a.position().left+a.width()&&e.scrollLeft(Math.round(a.position().left+a.width()-e.width())),$("figcaption").each(function(){var t=$(this),e=parseFloat(getComputedStyle(document.documentElement).fontSize);t.height()>10*e&&t.addClass("overflow").on("click",function(){t.toggleClass("overflow")})})}),$(window).on("resize",function(){resizeHeader()}),$(window).on("load",function(){if(resizeHeader(),window.addEventListener("beforeinstallprompt",t=>{t.userChoice.then(t=>{ga("send","event","A2HS",t.outcome)})}),$.fn.cookie(euCookie))new webPush("/push-sw.js");else{var t=$("template#cookie").html();$("body").append(t),setTimeout(function(){$("#modal-cookie").addClass("active")},100)}$("form[name=nwsubscribe]").submit(function(){var t=$(this);return $.ajax({url:"https://sciencex.com/api/nwletter/",type:"post",data:t.serialize()}).done(function(){t.html('<p class="text-light">We sent you a confirmation email with a link to activate your subscription</p>'),setTimeout(function(){$("#modal-nwletter").removeClass("active")},2e3)}),!1});var e=new Comments;if("IntersectionObserver"in window){new IntersectionObserver(function(t,a){$.each(t,function(){this.intersectionRatio>0&&(e.load(),a.unobserve(this.target))})},{rootMargin:parseInt(3*$(window).height()).toString()+"px 0px",threshold:.01}).observe(e.cm[0])}else e.load()});