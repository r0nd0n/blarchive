var API="https://sciencex.com/api/apps/web/physorg/",LST="pushNotify",VAPID="BOybuSIA7mfxsvZaBPCz4ZekXRVxHpk1Bt5KqGA1GGb5GNyAywD-ye1wFbPJm8KMnlLGuiBZHO4T0r87SdYnWA0";function Webpush(e){this.control=$("[data-action=webpush]"),"serviceWorker"in navigator&&"PushManager"in window&&this.registerServiceWorker(e)}Webpush.prototype={registerServiceWorker:function(e){var o=this;navigator.serviceWorker.register(e),navigator.serviceWorker.ready.then(function(t){"denied"===Notification.permission?(console.log("Notifications are blocked until this permission is manually changed in the browser"),o.control.addClass("fade"),localStorage&&(localSub=localStorage.getItem(LST))&&o.deleteSubscription(JSON.parse(localSub))):t.pushManager.getSubscription().then(function(e){e?(o.saveSubscription(e),o.control.html("Stop notifications").on("click",function(){e.unsubscribe().then(function(){o.control.addClass("fade"),o.deleteSubscription(e.toJSON())})})):o.createUI(t)}).catch(function(e){console.log("Error during getSubscription()",e)})}).catch(function(e){console.error("Service Worker error",e)})},saveSubscription:function(t){var e;localStorage&&(e=JSON.parse(localStorage.getItem(LST)))&&t.endpoint==e.endpoint||$.ajax(API+"subscribe/",{type:"post",mode:"cors",data:{subscription:t.toJSON(),vapid:VAPID,utc_offset:(new Date).getTimezoneOffset()/-60},success:function(e){e&&0===e.failed&&localStorage&&localStorage.setItem(LST,JSON.stringify({subscription:!0,endpoint:t.endpoint,vapid:VAPID,date:new Date}))}})},deleteSubscription:function(e){$.ajax(API+"unsubscribe/",{type:"post",mode:"cors",data:{subscription:e},success:function(){localStorage&&localStorage.getItem(LST)&&localStorage.removeItem(LST)}})},createUI:function(t){var o=this;this.control.click(function(){return t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:o.convertVapidKey(VAPID)}).then(function(e){t.showNotification("Awesome!",{body:"We will send you alerts for notable news stories. Please note that this subscription is browser specific, so if you want to receive notifications on another device, you will need to use it to re-subscribe.",icon:"https://sciencex.com/gfx/shared/phys_icon_192.png"}),o.saveSubscription(e),o.control.addClass("fade")}).catch(function(e){console.log("Error during subscribe()",e)}),!1})},convertVapidKey:function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),o=window.atob(t),a=new Uint8Array(o.length),i=0;i<o.length;++i)a[i]=o.charCodeAt(i);return a}};var Navigation=function(){if(this.target="[data-role=page]",0==$(this.target).length)return!1;this.pageBtn=$("a[data-page]"),this.page=this.pageBtn.data("page");var e=$("#block-p1");if(0<e.length){var t=e.find("div[data-order=1]"),o=e.find("div[data-order=2]"),a=0;$(t).children().each(function(){a+=$(this).outerHeight(!0)});var i=0;for($(o).children().each(function(){i+=$(this).outerHeight(!0)});1.03*a<i;){var n=o.children().last(),r=n.outerHeight(!0);n.remove(),i-=r}this.perPage=o.children().length,this.load(this.page)}else this.perPage=0;$(this.target).data("page",this.page),this.isLoading=0,this.didScroll=!1,this.historyAPI=window.history&&window.history.replaceState;var s=this;$(window).on("scroll",function(){s.scroll()}),setInterval(function(){s.didScroll&&(s.iniPagination(),s.didScroll=!1)},250),this.pageBtn.on("click",function(){var e=$(this).data("page");return s.load(e),!1}),2<this.page&&this.preload(this.page-2)};Navigation.prototype={scroll:function(){this.didScroll=!0},mostlyVisible:function(e){var t=$(window).scrollTop(),o=$(e).offset().top,a=$(e).height(),i=$(window).height();return t+.25*a<o+a&&o<t+.5*i},iniPagination:function(){if(this.historyAPI){$(window).scrollTop();var a=this;$(this.target).each(function(e){if(a.mostlyVisible(this)){var t=$(this).attr("data-page");if(t!=a.page){var o=1==(a.page=t)?"./":"./page"+t+".html";history.replaceState(null,null,o),2<a.page&&a.preload(a.page-1)}return!1}})}},load:function(t){if(this.isLoading)return!1;this.isLoading=!0,this.pageBtn.addClass("disabled");var o=this,e="./page"+t+".html";$.get(e,{l:o.perPage,cache:(new Date).getTime()}).done(function(e){0<e.length&&($("#load-more").append(e),o.pageBtn.data("page",t+1).removeClass("disabled"))}).always(function(){o.isLoading=0})},preload:function(o){if(o<2||0<$("div[data-page="+o+"]").length)return!1;this.isLoading=1;var e=this,t="./page"+o+".html";$.get(t,{l:e.perPage,cache:(new Date).getTime()}).done(function(e){var t=$("div[data-page="+(o+1)+"]");0<t.length?(t.before(e),window.scrollTo(0,$(window).scrollTop()+$(e).height())):0<(t=$("div[data-page="+(o-1)+"]")).length?t.after(e):($("#load-more").prepend(e),window.scrollTo(0,$(window).scrollTop()+$(e).height()))}).always(function(){e.isLoading=0})}};var adBlockAlert=function(){var e=void 0===ga.getAll?1:0,t=$.cookie("PhysAccount"),o=t?"&u="+btoa(t):"";$.ajax("https://sciencex.com/api/profile/?t="+e+o,{method:"get",crossDomain:!0}).done(function(e){var t,o;e.premium||(t=$("#adblock").html().trim(),o=$(t),$("header.header").append(o),o.addClass("show"))})};function euCookie(){var t=$("#js-popup-cookies"),o=$("[data-cookies-close]"),a="scx_euconsent";null==$.cookie(a)&&$.get("https://sciencex.com/api/location/",function(e){e.gdpr?(t.addClass("popup-cookies__displayed"),o.on("click",function(e){e.preventDefault(),$.cookie(a,1,{path:"/",domain:window.location.hostname.match(/([a-z0-9-]*?\.[a-z]{2,})$/)[1],expires:365}),t.removeClass("popup-cookies__displayed")})):$.cookie(a,0,{path:"/",domain:window.location.hostname.match(/([a-z0-9-]*?\.[a-z]{2,})$/)[1],expires:30})})}function imgDefer(){$("img[data-src]").each(function(){var e=$(this);e.attr("data-src")&&e.attr("src",e.attr("data-src")).removeAttr("data-src").removeClass("hidden")})}$(document).ready(function(){new Webpush("/push-sw.js"),new Navigation,euCookie();var t=$(".header-search__show"),o=$(".header-search__group");o.find(".header-search__field");if(t.click(function(e){$(this).addClass("search-open"),o.addClass("displayed")}),$(document).mouseup(function(e){0===o.has(e.target).length&&(t.removeClass("search-open"),o.removeClass("displayed")),$(".header-collapse").hasClass("show")&&"nav-link"!=e.target.className&&$(".header-collapse").collapse("hide")}),0<$("#nav-featured").length)var e=new SimpleBar($("#nav-featured")[0]);$(window).on("resize",function(){void 0!==e&&e.recalculate()}),$("a[data-toggle=tab]").on("show.bs.tab",function(e){var t=e.target,o=$(t).attr("href").substr(1),a=$("#"+o);if(0!=a.length&&!a.data("loaded")){var i=$(e.relatedTarget).attr("href").substr(1),n=$("#"+i).height();a.height(n+"px").load("/ajax/sort/"+o.substr(4)+"/",function(){setTimeout(function(){a.data("loaded",!0).height("auto"),s=new SimpleBar(a[0])},100)})}}),$("form[name=nwsubscribe]").submit(function(){var e=$(this);return $.ajax("https://sciencex.com/api/nwletter/",{method:"post",data:e.serialize()}).done(function(){e.html("<p>We sent you a confirmation email with a link to activate your subscription</p>")}),!1}),$("a[rel=top]").click(function(){return $.scrollTo($("head")),!1}),$("audio,video").each(function(){new Plyr($(this))}),void 0===window.blockAdBlock?adBlockAlert():(blockAdBlock.on(!0,adBlockAlert),blockAdBlock.on(!1,function(){var o=function(){var e="//www.googletagservices.com/tag/js/gpt.js";if(0<$('script[src*="'+e+'"]').length&&void 0===googletag.apiReady){var t=document.createElement("script");t.onerror=adBlockAlert,t.src=e,t.async=1,document.getElementsByTagName("head")[0].appendChild(t)}$(window).off("load",o)};"complete"!==document.readyState?$(window).on("load",o):o()}));var a=$("#secondaryNav");$("#collapseNavigation").on("show.bs.collapse",function(){a.css("opacity",0)}),$("#collapseNavigation").on("hide.bs.collapse",function(){a.css("opacity",1)}),$('button[data-target="#collapseNavigation"]').one("click",function(){$("#collapseNavigation").find(".dropdown-nav").load("/ajax/categories/",function(){setTimeout(function(){$(".nav-link[data-href]").one("mouseover",function(){var e=$(this).data("href");$(this).parent().find(".preview-nav").load("/ajax"+e)})},0)})}),"undefined"!=typeof $q&&$.each($q,function(e,t){$(t)}),"1"==$.cookie("physMob")&&$("#nav-mobile").one("click",function(){$.cookie("pdaPhysOrg",0,{path:"/",domain:".phys.org"})});var i=$("[data-col=main]");if(0<i.length){var n=i.children(),r=n.first(),c=n.last(),l=colRH=0;r.children().each(function(){l+=$(this).outerHeight(!0)}),c.children().each(function(){colRH+=$(this).outerHeight(!0)});var d=l-colRH;c.find(".categories_min-height-470").each(function(){var e=$(this).find(".categories-content__pane"),t=e.outerHeight();e.css("max-height",Math.round(t+d/2)+"px"),new SimpleBar(e[0])})}}),$(window).on("load",function(){imgDefer(),$(document).ajaxComplete(function(){setTimeout(imgDefer,0)})});