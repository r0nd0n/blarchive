function Comments(){if(this.api={comments:"/ajax/comments/",comment:"/ajax/comment/"},this.cm=$("#comments"),0==this.cm.length)return!1;this.id=this.cm.data("id");var o=this;this.cm.on("submit","form[name=signin]",function(){var t=$(this).serialize();return $.ajax(o.api.comments+"signin/",{type:"post",data:t,success:function(t){t.error&&o.message(t.error),t.success&&o.load()}}),!1}),this.cm.on("submit","form[name=comment]",function(){var t=$(this),e=t.serialize(),a=t.attr("action");return a=0<a.length?a:o.api.comments+o.id+"/",t.data("ajaxExec")||(t.data("ajaxExec",!0),$.ajax(a,{type:"post",data:e,success:function(t){t.error&&o.message(t.error),t.success&&o.load(1)},complete:function(){t.data("ajaxExec",!1)}})),!1}),this.cm.on("click","a[data-act=edit]",function(){var t=$(this).data("cid");return o.edit(t),!1}),this.cm.on("click","a[data-act=show]",function(){var e=$(this).data("cid");return $(this).addClass("fade"),$.get(o.api.comment+e+"/",function(t){t.error?o.message(t.error):$("#cm_"+e).html(t.data.comment)}),!1}),this.cm.on("click","a[data-act=ignore]",function(){$(this).addClass("fade");var t=$(this).data("cid"),e=$(this).data("block")?0:1;return $.ajax({url:o.api.comments+"ignore/"+t+"/",type:"post",data:{state:e}}).done(function(t){t.error?o.message(t.error):o.load(1)}),!1}),this.cm.on("change","input[data-act=follow]",function(){return $.ajax({url:o.api.comments+"follow/"+o.id+"/",type:"post",data:{follow:1}}),!1}),this.cm.on("click","a[data-act=flag]",function(){var t=$(this),e=t.data("cid"),a=$("<button/>").addClass("btn btn-warning text-bold text-low-up px-5 mt-4").html("Report");a.one("click",function(){$.post(o.api.comments+"flag/"+e+"/"),$("#comment-modal").modal("hide"),t.addClass("fade")});var n=$("<p>Report this comment as spam, offensive or inappropriate?</p>");return o.message(n),n.after(a),!1}),this.cm.on("change keyup paste","textarea[name=commenttext]",function(){var t=$(this),e=t.attr("maxlength"),a=t.val().length;$("#cmChCnt").html(e-a)}),this.cm.on("click","a[data-act=quote]",function(){var t=$(this).data("cid");return $.get(o.api.comment+t+"/",function(t){if(t.error)o.message(t.error);else{var e=o.cm.find("textarea[name=commenttext]");e.val("[q]"+t.data.raw+"[/q]"),e.trigger("change"),e.scrollHere({offset:-75})}}),!1}),this.cm.on("click","a[data-act=vote]",function(){var t=$(this),e=t.data("cid"),a="up"==t.data("vote")?1:-1,n=t.addClass("voted").parent().addClass("disabled").find("[data-sum]").addClass("fade");return $.post(o.api.comments+"rate/"+e+"/",{vote:a},function(t){t.error?o.message(t.error):n.html((parseInt(n.html())+a).toString()),setTimeout(function(){n.removeClass("fade")},250)}),!1})}function nwOptIn(){if(null!=$.cookie("scx_euconsent")){var e=Date.now()/1e3|0,t={hide:!1,v:1,exp:e+604800},a="scxNW",n="scXtestLC";try{localStorage.setItem(n,n),localStorage.removeItem(n)}catch(t){return!1}var o=localStorage.getItem(a),i=$("#js-popup-nwletter");if(null!=o){if((o=JSON.parse(o)).exp<e)localStorage.setItem(a,JSON.stringify(t));else if(!o.hide){if(o.v=parseInt(o.v),o.v++,localStorage.setItem(a,JSON.stringify(o)),3<o.v){var r=$("article.news-article"),s=!1,l=function(){var t=$(window).scrollTop()+$(window).height();r.offset().top+r.height()<=t+300&&(i.addClass("popup-cookies__displayed"),$(window).off("scroll",c),clearInterval(d))},c=function(){s=!0},d=setInterval(function(){s&&(l(),s=!1)},250);$(window).on("scroll",c),l()}i.find("form[name=popup-nwletter]").on("submit",function(){o.hide=!0,o.exp=e+31104e3,localStorage.setItem(a,JSON.stringify(o));var t=$(this);return $.ajax("https://sciencex.com/api/nwletter/",{method:"post",data:t.serialize()}).done(function(){t.html("<p>We sent you a confirmation email with a link to activate your subscription</p>")}),!1}),i.find("button[data-dismiss=modal]").on("click",function(){return i.removeClass("popup-cookies__displayed"),o.hide=!0,o.exp=Math.max(o.exp,e+5184e3),localStorage.setItem(a,JSON.stringify(o)),!1})}}else localStorage.setItem(a,JSON.stringify(t))}}$(document).ready(function(){var a=$("#js-soc-panel"),n=parseInt(a.offset().top),o=parseInt(a.offset().left),i=parseInt(a.outerHeight());function t(){if(960<$(window).width()){var t=$(document).scrollTop(),e=parseInt($(".news-related").offset().top);n<t?(a.addClass("soc-fixed"),a.css("left",o+"px")):(a.removeClass("soc-fixed"),a.css("left","auto")),e-i-50<t?a.addClass("soc-at-the-bottom"):a.removeClass("soc-at-the-bottom")}}$(".js-article-gallery").lightSlider({gallery:!0,item:1,loop:!0,thumbItem:7,slideMargin:0,enableDrag:!1,currentPagerPosition:"left",mode:"slide",useCSS:!0,cssEasing:"ease",easing:"linear",speed:600,prevHtml:'<svg><use xlink:href="#left-arrow" x="0" y="0"/></svg>',nextHtml:'<svg><use xlink:href="#right-arrow" x="0" y="0"/></svg>',verticalHeight:480,vThumbWidth:100,galleryMargin:5,thumbMargin:10,pager:!0,gallery:!0,currentPagerPosition:"middle",responsive:[{breakpoint:1560,settings:{thumbItem:5}},{breakpoint:1200,settings:{thumbItem:6}},{breakpoint:960,settings:{thumbItem:6}}],onSliderLoad:function(t){t.lightGallery({selector:".js-article-gallery .lslide",getCaptionFromTitleOrAlt:!1,download:!0,thumbnail:!0})}}),t();var r=$("#js-news-related-slider").lightSlider({item:1,slideMargin:0,speed:600,loop:!1,controls:!1,galleryMargin:0,gallery:!1,onSliderLoad:function(t){$(".news-related .lSPager").appendTo(".js-news-related__wrap"),$(".js-news-related__wrap .lSPager").addClass("news-related__custom-dots")},onAfterSlide:function(){for(var t=r.getCurrentSlideCount(),e=document.querySelectorAll(".news-related__custom-dots li a"),a=0;a<e.length;a++)e[a].parentNode.classList.remove("active"),parseInt(e[a].innerHTML)===t&&e[a].parentNode.classList.add("active")}}),e=$(".soc-panel-close button");$(window).width()<960&&(setTimeout(function(){a.addClass("displayed")},1e3),e.click(function(){a.removeClass("displayed")})),$(window).on("scroll",function(){t()})}),$(function(){var t=document.querySelector("link[rel=canonical]"),e=null!==t?t.href:document.location.href,a=function(t,e){var a=0<t?t:500,n=0<e?e:400;return["menubar=no,toolbar=no,resizable=yes,scrollbars=yes","height="+n,"width="+a,"left="+($(window).width()/2-a/2),"top="+($(window).height()/2-n/2)].join()},n=function(t){return!1!==t[0].checkValidity()||(t.find("[required]").each(function(){var t=$(this);t.removeClass("is-invalid"),t[0].willValidate&&!t[0].checkValidity()&&t.addClass("is-invalid")}),!1)};$(".fb").click(function(){return FB.ui({method:"share",mobile_iframe:!0,href:e},function(t){}),!1}),$(".goog").click(function(){return window.open($(this).attr("href"),"",a(600,600)).opener=null,!1}),$(".tw").click(function(){var t="https://twitter.com/intent/tweet?text="+($(this).data("title")+" "+encodeURIComponent(e)+" via @"+$(this).data("via"));return window.open(t,"ShareOnTwitter",a(500,450)).opener=null,!1}),$(".ln").click(function(){var t="https://www.linkedin.com/shareArticle?mini=true&url="+e;return window.open(t,"ShareOnLinkedIN",a(520,570)).opener=null,!1}),$("#fav").click(function(){var t=$(this).data("nid"),e=$.cookie("PhysAccount"),a=e?"?u="+btoa(e):"";return $.ajax("https://sciencex.com/api/story/addFav/"+t+"/"+a,{method:"get",crossDomain:!0}).done(function(){$("#notify").find(".modal-message").html("Saved to your Science X account")}).fail(function(){$("#notify").find(".modal-message").html('Please sign into <a href="https://sciencex.com/profile/login/">Science X account</a>')}).always(function(){$("#notify").modal("show")}),!1}),$("form[name=email]").on("submit",function(){var e=$(this),t=e.attr("action"),a=e.serialize();return n(e)&&$.post(t,a).done(function(t){t.error?($("#email-error").html(t.error),2==t.code?e.find("input[type=email]").addClass("is-invalid"):1==t.code&&e.find("[required]").addClass("is-invalid")):(e[0].reset(),$("#feedback-email").modal("hide"))}).fail(function(){e[0].reset(),$("#feedback-email").modal("hide"),alert("An unknown error has occurred")}),!1}),$("form[name=feedback]").on("submit",function(){var t=$(this),e=t.attr("action"),a=t.serialize();return n(t)&&(a+="&xRequest=true",$.post(e,a).always(function(){t.find(".modal-body").hide(),t.find("button[type=submit]").hide(),t.find(".message").removeClass("d-none")})),!1})}),Comments.prototype={load:function(t){var e=this;this.cm.addClass("fade"),this.cm.load(this.api.comments+this.id+"/"+(1==t?"?s="+Math.random():""),function(){e.cm.removeClass("fade")})},message:function(t){var e=$("#comment-modal");$("#comment-message").html(t),e.modal("show")},edit:function(a){var n=this;$.get(this.api.comment+a+"/").done(function(t){if(t.success){var e=n.cm.find("form[name=comment]");e.find("textarea[name=commenttext]").val(t.data.raw),e.attr("action",n.api.comment+a+"/"),e.scrollHere({offset:-75})}else n.message(t.error)})}},$(document).ready(function(){$(".lightGallery").lightGallery({getCaptionFromTitleOrAlt:!1,download:!0,thumbnail:!0}),$(".text-truncate-js").addClass("text-truncate");var t=$(".article").height();1.15<$(".article-sidebar").height()/t&&new SimpleBar($("#nwrel").addClass("categories-content__pane")[0]);var a=$("#news-more"),n=new Comments;if("IntersectionObserver"in window){var e=new IntersectionObserver(function(t,e){$.each(t,function(){0<this.intersectionRatio&&(a[0]==this.target?a.attr("data-loaded",!0).load("/ajax/story/",{ads:a.data("ads")}):n.cm[0]==this.target&&n.load(),e.unobserve(this.target))})},{rootMargin:parseInt($(window).height()).toString()+"px 0px",threshold:.01});e.observe(a[0]),e.observe(n.cm[0])}else a.attr("data-loaded",!0).load("/ajax/story/",{ads:a.data("ads")}),n.load();nwOptIn()});